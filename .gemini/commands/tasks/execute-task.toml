[metadata]
argument-hint = "{{plan_id}} [task-ID]"
description = "Execute a single task with dependency validation and status management"

[prompt]
content = """# Single Task Execution\n\nYou are responsible for executing a single task within a plan while maintaining strict dependency validation and proper status management. Your role is to ensure the task is ready for execution, deploy the appropriate agent, and track execution progress.\n\nUse your internal Todo task tool to track the execution of all parts of the task, and the final update of noteworthy items during execution. Example:\n\n- [ ] Validate task: file, status, and dependencies.\n- [ ] Select the most appropriate sub-agent.\n- [ ] Set task status to in-progress.\n- [ ] Delegate task implementation to the sub-agent.\n- [ ] Update task status to completed or failed.\n- [ ] Update the task file with noteworthy events during execution.\n\n## Critical Rules\n\n1. **Never skip dependency validation** - Task execution requires all dependencies to be completed\n2. **Validate task status** - Never execute tasks that are already completed or in-progress\n3. **Maintain status integrity** - Update task status throughout the execution lifecycle\n4. **Use appropriate agents** - Match task skills to available sub-agents\n5. **Document execution** - Record all outcomes and issues encountered\n\n## Input Requirements\n- Plan ID: {{plan_id}} (required)\n- Task ID: {{param2}} (required)\n- Task management directory structure: `/`\n- Dependency checking script: `.ai/task-manager/config/scripts/check-task-dependencies.cjs`\n\n### Input Validation\n\nFirst, validate that both arguments are provided:\n\n```bash\nif [ -z \"{{plan_id}}\" ] || [ -z \"{{param2}}\" ]; then\n    echo \"Error: Both plan ID and task ID are required\"\n    echo \"Usage: /tasks:execute-task [plan-ID] [task-ID]\"\n    echo \"Example: /tasks:execute-task 16 03\"\n    exit 1\nfi\n```\n\n## Execution Process\n\n### 1. Plan and Task Location\n\nLocate the plan directory using the established find pattern:\n\n```bash\nPLAN_ID=\"{{plan_id}}\"\nTASK_ID=\"{{param2}}\"\n\n# Find plan directory\nPLAN_DIR=$(find .ai/task-manager/{plans,archive} -type d -name \"${PLAN_ID}--*\" 2>/dev/null | head -1)\n\nif [ -z \"$PLAN_DIR\" ]; then\n    echo \"Error: Plan with ID ${PLAN_ID} not found\"\n    echo \"Available plans:\"\n    find .ai/task-manager/plans -name \"*--*\" -type d | head -5\n    exit 1\nfi\n\necho \"Found plan: $PLAN_DIR\"\n```\n\n### 2. Task File Validation\n\nLocate and validate the specific task file:\n\n```bash\n# Handle both padded (01, 02) and unpadded (1, 2) task IDs\nTASK_FILE=\"\"\nif [ -f \"${PLAN_DIR}/tasks/${TASK_ID}--\"*.md ]; then\n    TASK_FILE=$(ls \"${PLAN_DIR}/tasks/${TASK_ID}--\"*.md 2>/dev/null | head -1)\nelif [ -f \"${PLAN_DIR}/tasks/0${TASK_ID}--\"*.md ]; then\n    TASK_FILE=$(ls \"${PLAN_DIR}/tasks/0${TASK_ID}--\"*.md 2>/dev/null | head -1)\nfi\n\nif [ -z \"$TASK_FILE\" ] || [ ! -f \"$TASK_FILE\" ]; then\n    echo \"Error: Task with ID ${TASK_ID} not found in plan ${PLAN_ID}\"\n    echo \"Available tasks in plan:\"\n    find \"$PLAN_DIR/tasks\" -name \"*.md\" -type f | head -5\n    exit 1\nfi\n\necho \"Found task: $(basename \"$TASK_FILE\")\"\n```\n\n### 3. Task Status Validation\n\nCheck current task status to ensure it can be executed:\n\n```bash\n# Extract current status from task frontmatter\nCURRENT_STATUS=$(awk '\n    /^---$/ { if (++delim == 2) exit }\n    /^status:/ {\n        gsub(/^status:[ \\t]*/, \"\")\n        gsub(/^[\"'\\'']/, \"\")\n        gsub(/[\"'\\'']$/, \"\")\n        print\n        exit\n    }\n' \"$TASK_FILE\")\n\necho \"Current task status: ${CURRENT_STATUS:-unknown}\"\n\n# Validate status allows execution\ncase \"$CURRENT_STATUS\" in\n    \"completed\")\n        echo \"Error: Task ${TASK_ID} is already completed\"\n        echo \"Use execute-blueprint to re-execute the entire plan if needed\"\n        exit 1\n        ;;\n    \"in-progress\")\n        echo \"Error: Task ${TASK_ID} is already in progress\"\n        echo \"Wait for current execution to complete or check for stale processes\"\n        exit 1\n        ;;\n    \"pending\"|\"failed\"|\"\")\n        echo \"Task status allows execution - proceeding...\"\n        ;;\n    *)\n        echo \"Warning: Unknown task status '${CURRENT_STATUS}' - proceeding with caution...\"\n        ;;\nesac\n```\n\n### 4. Dependency Validation\n\nUse the dependency checking script to validate all dependencies:\n\n```bash\n# Call the dependency checking script\nif ! node .ai/task-manager/config/scripts/check-task-dependencies.cjs \"$PLAN_ID\" \"$TASK_ID\"; then\n    echo \"\"\n    echo \"Task execution blocked by unresolved dependencies.\"\n    echo \"Please complete the required dependencies first.\"\n    exit 1\nfi\n\necho \"\"\necho \"✓ All dependencies resolved - proceeding with execution\"\n```\n\n### 5. Agent Selection\n\nRead task skills and select appropriate task-specific agent:\n\nRead and execute .ai/task-manager/config/hooks/PRE_TASK_ASSIGNMENT.md\n\n### 6. Status Update to In-Progress\n\nUpdate task status before execution:\n\n```bash\necho \"Updating task status to in-progress...\"\n\n# Create temporary file with updated status\nTEMP_FILE=$(mktemp)\nawk '\n    /^---$/ {\n        if (++delim == 1) {\n            print\n            next\n        } else if (delim == 2) {\n            print \"status: \\\"in-progress\\\"\"\n            print\n            next\n        }\n    }\n    /^status:/ && delim == 1 {\n        print \"status: \\\"in-progress\\\"\"\n        next\n    }\n    { print }\n' \"$TASK_FILE\" > \"$TEMP_FILE\"\n\n# Replace original file\nmv \"$TEMP_FILE\" \"$TASK_FILE\"\n\necho \"✓ Task status updated to in-progress\"\n```\n\n### 7. Task Execution\n\nDeploy the task using the Task tool with full context:\n\n**Task Deployment**: Use your internal Task tool to execute the task with the following context:\n- Task file path: `$TASK_FILE`\n- Plan directory: `$PLAN_DIR`\n- Required skills: `$TASK_SKILLS`\n- Agent selection: Based on skills analysis or general-purpose agent\n\nRead the complete task file and execute according to its requirements. The task includes:\n- Objective and acceptance criteria\n- Technical requirements and implementation notes\n- Input dependencies and expected output artifacts\n\n### 8. Post-Execution Status Management\n\nAfter task completion, update the status based on execution outcome:\n\n```bash\nTEMP_FILE=$(mktemp)\nawk '\n    /^---$/ {\n        if (++delim == 1) {\n            print\n            next\n        } else if (delim == 2) {\n            print \"status: \\\"completed\\\"\"\n            print\n            next\n        }\n    }\n    /^status:/ && delim == 1 {\n        print \"status: \\\"completed\\\"\"\n        next\n    }\n    { print }\n' \"$TASK_FILE\" > \"$TEMP_FILE\"\n\nmv \"$TEMP_FILE\" \"$TASK_FILE\"\n\necho \"✓ Task ${TASK_ID} completed successfully\"\necho \"\"\necho \"You can now execute dependent tasks or continue with the full blueprint execution.\"\n```\n\n## Error Handling\n\nRead and execute .ai/task-manager/config/hooks/POST_ERROR_DETECTION.md\n\n## Usage Examples\n\n```bash\n# Execute a specific task\n/tasks:execute-task 16 1\n\n# Execute task with zero-padded ID\n/tasks:execute-task 16 03\n\n# Execute task from archived plan\n/tasks:execute-task 12 05\n```\n\n## Integration Notes\n\nThis command integrates with the existing task management system by:\n- Using established plan and task location patterns\n- Leveraging the dependency checking script for validation\n- Following status management conventions\n- Maintaining compatibility with execute-blueprint workflows\n- Preserving task isolation and dependency order\n\nThe command complements execute-blueprint by providing granular task control while maintaining the same validation and execution standards."""
