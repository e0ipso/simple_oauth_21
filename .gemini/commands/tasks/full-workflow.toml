[metadata]
argument-hint = "{{args}}"
description = "Execute the full workflow from plan creation to blueprint execution"

[prompt]
content = """# Full Workflow Execution\n\n## Assistant Configuration\n\nBefore proceeding with this command, you MUST load and respect the assistant's configuration:\n\n**Run the following scripts:**\n```bash\nASSISTANT=$(node .ai/task-manager/config/scripts/detect-assistant.cjs)\nnode .ai/task-manager/config/scripts/read-assistant-config.cjs \"$ASSISTANT\"\n```\n\nThe output above contains your global and project-level configuration rules. You MUST keep these rules and guidelines in mind during all subsequent operations in this command.\n\n---\n\nYou are a workflow orchestration assistant. Your role is to execute the complete task management workflow from plan creation through blueprint execution with minimal user interaction.\n\n## Instructions\n\nThe user input is:\n\n<user-input>\n{{args}}\n</user-input>\n\nIf no user input is provided, stop immediately and show an error message to the user.\n\n### Workflow Execution Process\n\nUse your internal Todo task tool to track the workflow execution:\n\n- [ ] Execute /tasks:create-plan\n- [ ] Extract plan ID from created plan\n- [ ] Execute /tasks:generate-tasks\n- [ ] Execute /tasks:execute-blueprint\n\n#### Step 1: Execute Plan Creation\n\nUse the SlashCommand tool to execute plan creation with the user's prompt:\n\n```\n/tasks:create-plan {{args}}\n```\n\n**Important**: The plan creation command may ask clarification questions. Wait for user responses before continuing. This is expected behavior and maintains quality control.\n\n**CRITICAL**: Do not wait for user approval or review of the plan. In full-workflow mode, plan validation is automated (Step 2 performs file existence checking only). Proceed immediately to Step 2 without waiting for user input.\n\n#### Step 2: Extract Plan ID and Set Approval Method\n\nAfter the plan is created, extract the Plan ID from the structured output in the conversation context.\n\n**Instructions for the LLM:**\n\nThe create-plan command outputs a structured summary in this format:\n```\n---\nPlan Summary:\n- Plan ID: [numeric-id]\n- Plan File: [full-path-to-plan-file]\n```\n\n1. Look at the output from the previous step (create-plan) in your conversation context\n2. Extract the Plan ID from the \"Plan Summary\" section\n3. Extract the Plan File path\n4. Set the approval method to auto using that file path\n\n**Example approach:**\n\n```bash\n# Use the Plan File path from the create-plan output above\nPLAN_FILE=\"[extracted-from-context]\"\n\n# Set approval_method to auto for automated workflow execution\n# This ensures generate-tasks and execute-blueprint run without interruption\nnode .ai/task-manager/config/scripts/set-approval-method.cjs \"$PLAN_FILE\" auto\n```\n\n**Note**: Setting `approval_method: auto` in the plan metadata signals to subordinate commands (generate-tasks, execute-blueprint) that they are running in automated workflow mode and should suppress interactive prompts for plan review. This metadata persists in the plan document and is reliably read by subsequent commands.\n\n#### Step 3: Execute Task Generation\n\nUse the Plan ID extracted from Step 2 and execute the generate-tasks command.\n\n**Instructions for the LLM:**\n\nUse the Plan ID that you extracted in Step 2 from the conversation context.\n\n```\n/tasks:generate-tasks [plan-id-from-step-2]\n```\n\nAfter task generation completes, the command will output a structured summary:\n```\n---\nTask Generation Summary:\n- Plan ID: [numeric-id]\n- Tasks: [count]\n- Status: Ready for execution\n```\n\nProvide a progress update: \"Step 2/3: Task generation completed\"\n\n#### Step 4: Execute Blueprint\n\nUse the Plan ID from previous steps and execute the blueprint.\n\n**Instructions for the LLM:**\n\nUse the same Plan ID that you've been using in previous steps.\n\n```\n/tasks:execute-blueprint [plan-id]\n```\n\nAfter blueprint execution completes, the command will output a structured summary:\n```\n---\nExecution Summary:\n- Plan ID: [numeric-id]\n- Status: Archived\n- Location: .ai/task-manager/archive/[plan-id]--[plan-name]/\n```\n\nProvide a progress update: \"Step 3/3: Blueprint execution completed\"\n\nNote: The execute-blueprint command automatically archives the plan upon successful completion.\n\n### Output Requirements\n\nThe execute-blueprint command outputs a structured summary with the archive location. Use that information to generate the extremely concise final summary.\n"""
